<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Financial Calculators</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body
    class="bg-slate-900 text-white min-h-screen flex flex-col items-center justify-start p-6 space-y-6"
  >
    <!-- Calculator Selector -->
    <div class="relative w-full max-w-md">
      <button
        id="calcBtn"
        class="w-full p-2 rounded bg-white/10 border border-white/20 text-slate-100 flex justify-between items-center"
      >
        <span id="calcText">CAGR Calculator</span>
        <span class="text-slate-300">â–¼</span>
      </button>
      <ul
        id="calcOptions"
        class="absolute w-full mt-1 bg-slate-800 border border-white/20 rounded shadow-lg hidden z-10"
      >
        <li
          data-value="cagr"
          class="p-2 hover:bg-indigo-600 cursor-pointer text-slate-100"
        >
          CAGR Calculator
        </li>
        <li
          data-value="sip"
          class="p-2 hover:bg-indigo-600 cursor-pointer text-slate-100"
        >
          SIP Calculator
        </li>
      </ul>
    </div>

    <!-- CAGR Calculator -->
    <div
      id="cagrCalc"
      class="bg-white/5 backdrop-blur rounded-2xl p-6 shadow-lg border border-white/10 max-w-lg w-full"
    >
      <h2 class="text-2xl font-semibold mb-4 text-center">
        ðŸ“ˆ CAGR Calculator
      </h2>

      <!-- Mode Dropdown -->
      <div class="relative w-full mb-6">
        <button
          id="modeBtn"
          class="w-full p-2 rounded bg-white/10 border border-white/20 text-slate-100 flex justify-between items-center"
        >
          <span id="modeText">Calculate Output (FV)</span>
          <span class="text-slate-300">â–¼</span>
        </button>
        <ul
          id="modeOptions"
          class="absolute w-full mt-1 bg-slate-800 border border-white/20 rounded shadow-lg hidden z-10"
        >
          <li
            data-value="fv"
            class="p-2 hover:bg-indigo-600 cursor-pointer text-slate-100"
          >
            Calculate Output (FV)
          </li>
          <li
            data-value="pv"
            class="p-2 hover:bg-indigo-600 cursor-pointer text-slate-100"
          >
            Calculate Input (PV)
          </li>
        </ul>
      </div>

      <!-- Inputs -->
      <div class="space-y-4">
        <label class="block" id="pvField">
          <span class="text-slate-300">Input Value (PV, â‚¹)</span>
          <input
            id="pv"
            type="text"
            value="10,00,000"
            class="mt-1 w-full p-2 rounded bg-white/10 border border-white/20 text-slate-100"
          />
        </label>

        <label class="block" id="fvField" style="display: none">
          <span class="text-slate-300">Target Output Value (FV, â‚¹)</span>
          <input
            id="fv"
            type="text"
            value="10,00,00,000"
            class="mt-1 w-full p-2 rounded bg-white/10 border border-white/20 text-slate-100"
          />
        </label>

        <label class="block">
          <span class="text-slate-300">Time (Years)</span>
          <input
            id="years"
            type="text"
            value="20"
            class="mt-1 w-full p-2 rounded bg-white/10 border border-white/20 text-slate-100"
          />
        </label>

        <label class="block">
          <span class="text-slate-300">CAGR (%)</span>
          <input
            id="rate"
            type="text"
            value="15"
            class="mt-1 w-full p-2 rounded bg-white/10 border border-white/20 text-slate-100"
          />
        </label>
      </div>

      <!-- Result -->
      <div class="mt-6 text-center text-xl font-semibold">
        <span id="result" class="text-indigo-300">â€”</span>
      </div>

      <!-- Chart -->
      <div class="mt-6">
        <canvas></canvas>
      </div>
    </div>

    <!-- SIP Calculator -->
    <div
      id="sipCalc"
      class="bg-white/5 backdrop-blur rounded-2xl p-6 shadow-lg border border-white/10 max-w-lg w-full hidden"
    >
      <h2 class="text-2xl font-semibold mb-4 text-center">ðŸ’° SIP Calculator</h2>

      <div class="space-y-4">
        <label class="block">
          <span class="text-slate-300">Monthly SIP Amount (â‚¹)</span>
          <input
            id="sipAmount"
            type="text"
            value="10,000"
            class="mt-1 w-full p-2 rounded bg-white/10 border border-white/20 text-slate-100"
          />
        </label>

        <label class="block">
          <span class="text-slate-300">Time (Years)</span>
          <input
            id="sipYears"
            type="text"
            value="20"
            class="mt-1 w-full p-2 rounded bg-white/10 border border-white/20 text-slate-100"
          />
        </label>

        <label class="block">
          <span class="text-slate-300">CAGR (%)</span>
          <input
            id="sipRate"
            type="text"
            value="15"
            class="mt-1 w-full p-2 rounded bg-white/10 border border-white/20 text-slate-100"
          />
        </label>
      </div>

      <!-- Result -->
      <div class="mt-6 text-center text-xl font-semibold">
        <span id="sipResult" class="text-indigo-300">â€”</span>
      </div>

      <!-- Chart -->
      <div class="mt-6">
        <canvas></canvas>
      </div>
    </div>

    <!-- Script -->
    <script>
      class Utils {
        static formatINR(num) {
          if (isNaN(num)) return "";
          return new Intl.NumberFormat("en-IN").format(num);
        }

        static unformatNumber(str) {
          if (!str) return 0;
          return parseFloat(str.toString().replace(/,/g, "")) || 0;
        }

        static formatInput(el, type) {
          let val = el.value;
          if (type === "currency") {
            el.value = Utils.formatINR(Utils.unformatNumber(val));
          } else if (type === "integer") {
            el.value = Utils.formatINR(Math.floor(Utils.unformatNumber(val)));
          } else if (type === "float") {
            el.value = val.replace(/[^0-9.]/g, "");
          }
        }
      }

      class Calculator {
        constructor(containerId) {
          this.container = document.getElementById(containerId);
          this.chart = null;
        }

        initInputs(config) {
          Object.keys(config).forEach((id) => {
            const el = this.container.querySelector(`#${id}`);
            Utils.formatInput(el, config[id]);

            el.addEventListener("input", () => {
              Utils.formatInput(el, config[id]);
              this.recalc();
            });

            el.addEventListener("blur", () =>
              Utils.formatInput(el, config[id])
            );
          });
        }

        updateChart(labels, values) {
          const ctx = this.container.querySelector("canvas").getContext("2d");
          if (this.chart) this.chart.destroy();
          this.chart = new Chart(ctx, {
            type: "pie",
            data: {
              labels: labels,
              datasets: [
                {
                  data: values,
                  backgroundColor: ["#4f46e5", "#16a34a", "#f59e0b"],
                },
              ],
            },
            options: {
              plugins: {
                tooltip: {
                  callbacks: {
                    label: (context) => {
                      return (
                        context.label +
                        ": â‚¹" +
                        Utils.formatINR(context.raw.toFixed(0))
                      );
                    },
                  },
                },
              },
            },
          });
        }
      }

      class CAGRCalculator extends Calculator {
        constructor(containerId) {
          super(containerId);

          this.config = {
            pv: "currency",
            fv: "currency",
            years: "integer",
            rate: "float",
          };
          this.initInputs(this.config);
          this.mode = "fv";

          // Mode dropdown
          const modeBtn = this.container.querySelector("#modeBtn");
          const modeText = this.container.querySelector("#modeText");
          const modeOptions = this.container.querySelector("#modeOptions");

          modeBtn.addEventListener("click", () =>
            modeOptions.classList.toggle("hidden")
          );
          modeOptions.querySelectorAll("li").forEach((li) => {
            li.addEventListener("click", () => {
              this.mode = li.dataset.value;
              modeText.textContent = li.textContent;
              modeOptions.classList.add("hidden");

              this.container.querySelector("#pvField").style.display =
                this.mode === "fv" ? "block" : "none";
              this.container.querySelector("#fvField").style.display =
                this.mode === "pv" ? "block" : "none";
              this.recalc();
            });
          });

          this.recalc();
        }

        recalc() {
          const pv = Utils.unformatNumber(
            this.container.querySelector("#pv").value
          );
          const fv = Utils.unformatNumber(
            this.container.querySelector("#fv").value
          );
          const years = Utils.unformatNumber(
            this.container.querySelector("#years").value
          );
          const rate =
            parseFloat(this.container.querySelector("#rate").value) || 0;

          let resultVal = 0;
          if (this.mode === "fv") {
            resultVal = pv * Math.pow(1 + rate / 100, years);
            this.container.querySelector("#result").textContent =
              "Final Value (FV): â‚¹" + Utils.formatINR(resultVal.toFixed(0));
            this.updateChart(["Invested", "Returns"], [pv, resultVal - pv]);
          } else {
            resultVal = fv / Math.pow(1 + rate / 100, years);
            this.container.querySelector("#result").textContent =
              "Required Input (PV): â‚¹" + Utils.formatINR(resultVal.toFixed(0));
            this.updateChart(
              ["Required Input", "Returns"],
              [resultVal, fv - resultVal]
            );
          }
        }
      }

      class SIPCalculator extends Calculator {
        constructor(containerId) {
          super(containerId);

          this.config = {
            sipAmount: "currency",
            sipYears: "integer",
            sipRate: "float",
          };
          this.initInputs(this.config);
          this.recalc();
        }

        recalc() {
          const amount = Utils.unformatNumber(
            this.container.querySelector("#sipAmount").value
          );
          const years = Utils.unformatNumber(
            this.container.querySelector("#sipYears").value
          );
          const rate =
            parseFloat(this.container.querySelector("#sipRate").value) || 0;

          const months = years * 12;
          const monthlyRate = rate / 100 / 12;
          let fv = 0;
          for (let i = 1; i <= months; i++) {
            fv = (fv + amount) * (1 + monthlyRate);
          }
          const invested = amount * months;
          const returns = fv - invested;

          this.container.querySelector("#sipResult").textContent =
            "Final Value: â‚¹" + Utils.formatINR(fv.toFixed(0));
          this.updateChart(["Invested", "Returns"], [invested, returns]);
        }
      }

      // Initialize calculators
      new CAGRCalculator("cagrCalc");
      new SIPCalculator("sipCalc");

      // Global calculator switcher
      const calcBtn = document.getElementById("calcBtn");
      const calcText = document.getElementById("calcText");
      const calcOptions = document.getElementById("calcOptions");

      calcBtn.addEventListener("click", () =>
        calcOptions.classList.toggle("hidden")
      );
      calcOptions.querySelectorAll("li").forEach((li) => {
        li.addEventListener("click", () => {
          calcText.textContent = li.textContent;
          calcOptions.classList.add("hidden");
          document.getElementById("cagrCalc").classList.add("hidden");
          document.getElementById("sipCalc").classList.add("hidden");
          if (li.dataset.value === "cagr")
            document.getElementById("cagrCalc").classList.remove("hidden");
          else document.getElementById("sipCalc").classList.remove("hidden");
        });
      });
    </script>
  </body>
</html>
